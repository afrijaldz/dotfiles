var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,i=Object.getOwnPropertySymbols,s=Object.prototype.propertyIsEnumerable,n=(t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s,a=(e,a)=>{for(var o in a||(a={}))t.call(a,o)&&n(e,o,a[o]);if(i)for(var o of i(a))s.call(a,o)&&n(e,o,a[o]);return e};import{r as o,b as r,d as h,R as l,e as d,a as c,c as p}from"./vendor.8a5db82d.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(i){const s=new URL(e,location),n=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((i,a)=>{const o=new URL(e,s);if(self[t].moduleMap[o])return i(self[t].moduleMap[o]);const r=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),h=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(r),onerror(){a(new Error(`Failed to import: ${e}`)),n(h)},onload(){i(self[t].moduleMap[o]),n(h)}});document.head.appendChild(h)})),self[t].moduleMap={}}}("/assets/");var u,m;(m=u||(u={})).Cut="Cut",m.Copy="Copy",m.Paste="Paste",m.PasteAndGo="Paste & Go",m.Delete="Delete",m.SelectAll="Select All",m.Seperator="-";class v extends o.Component{constructor(e){super(e),this.state={itemType:this.props.itemType,isDisabled:this.props.isDisabled||!1},this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.isDisabled!==this.state.isDisabled&&this.setState({isDisabled:e.isDisabled})}handleClick(e){this.props.handleClick(e),this.props.setVisibility(!1)}render(){const e=["contextMenuItem"];return this.state.isDisabled&&e.push("disabled"),this.state.itemType===u.Seperator&&(e.push("disabled"),e.push("separator")),this.state.itemType===u.Seperator?o.createElement("li",{className:e.join(" ")}):o.createElement("li",{className:e.join(" "),onClick:this.handleClick},this.state.itemType)}}class g extends o.Component{constructor(e){super(e),this.state={isVisible:!1,position:{x:0,y:0},menuItems:[{itemType:u.Cut,setVisibility:this.props.setVisibility,handleClick:e=>this.CutHandler(e)},{itemType:u.Copy,setVisibility:this.props.setVisibility,handleClick:e=>this.CopyHandler(e)},{itemType:u.Paste,setVisibility:this.props.setVisibility,handleClick:e=>this.PasteHandler(e)},{itemType:u.PasteAndGo,setVisibility:this.props.setVisibility,handleClick:e=>this.PasteGoHandler(e)},{itemType:u.Delete,setVisibility:this.props.setVisibility,handleClick:e=>this.DeleteHandler(e)},{itemType:u.Seperator,setVisibility:this.props.setVisibility,handleClick:()=>{}},{itemType:u.SelectAll,setVisibility:this.props.setVisibility,handleClick:e=>this.SelectAllHandler(e)}]},this.setRef=this.setRef.bind(this),this.handleClickOutside=this.handleClickOutside.bind(this)}UNSAFE_componentWillReceiveProps(e){e.position.x===this.state.position.x&&e.position.y===this.state.position.y||this.setState({position:e.position}),e.isVisible!==this.state.isVisible&&(this.setState({isVisible:e.isVisible}),this.manageMenuItemsStatus())}componentDidMount(){document.addEventListener("mousedown",this.handleClickOutside)}componentWillUnmount(){document.removeEventListener("mousedown",this.handleClickOutside)}async manageMenuItemsStatus(){var e,t;const i=[...this.state.menuItems],s=this.state.menuItems.find((e=>e.itemType===u.Cut)),n=this.state.menuItems.findIndex((e=>e.itemType===u.Cut)),a=this.state.menuItems.find((e=>e.itemType===u.Copy)),o=this.state.menuItems.findIndex((e=>e.itemType===u.Copy)),r=this.state.menuItems.find((e=>e.itemType===u.Delete)),h=this.state.menuItems.findIndex((e=>e.itemType===u.Delete)),l=null==(t=null==(e=null==window?void 0:window.getSelection())?void 0:e.toString())?void 0:t.length;l&&l>0?(s&&(i[n].isDisabled=!1,this.setState({menuItems:i})),a&&(i[o].isDisabled=!1,this.setState({menuItems:i})),r&&(i[h].isDisabled=!1,this.setState({menuItems:i}))):(s&&(i[n].isDisabled=!0,this.setState({menuItems:i})),a&&(i[o].isDisabled=!0,this.setState({menuItems:i})),r&&(i[h].isDisabled=!0,this.setState({menuItems:i})));const d=this.state.menuItems.find((e=>e.itemType===u.Paste)),c=this.state.menuItems.findIndex((e=>e.itemType===u.Paste)),p=this.state.menuItems.find((e=>e.itemType===u.PasteAndGo)),m=this.state.menuItems.findIndex((e=>e.itemType===u.PasteAndGo));this.props.onActionInvoked&&await this.props.onActionInvoked("readClipboard")?(d&&(i[c].isDisabled=!1,this.setState({menuItems:i})),p&&(i[m].isDisabled=!1,this.setState({menuItems:i}))):(d&&(i[c].isDisabled=!0,this.setState({menuItems:i})),p&&(i[m].isDisabled=!0,this.setState({menuItems:i})))}render(){const e=["contextMenu"];this.state.isVisible||e.push("hidden");const t={left:this.state.position.x,top:this.state.position.y};return o.createElement("ul",{className:e.join(" "),style:t,ref:this.setRef},this.state.menuItems.map(((e,t)=>o.createElement(v,a(a({},e),{key:t})))))}setRef(e){this.ref=e}handleClickOutside(e){this.ref&&!this.ref.contains(e.target)&&this.props.setVisibility(!1)}async CutHandler(e){this.props.onActionInvoked&&this.props.selectedUrlInput&&(await this.props.onActionInvoked("writeClipboard",{value:this.props.selectedUrlInput}),this.props.setUrl(""))}async CopyHandler(e){this.props.onActionInvoked&&this.props.selectedUrlInput&&await this.props.onActionInvoked("writeClipboard",{value:this.props.selectedUrlInput})}async PasteHandler(e){if(this.props.onActionInvoked){const e=await this.props.onActionInvoked("readClipboard");e&&this.props.setUrl(e)}}async PasteGoHandler(e){if(this.props.onActionInvoked&&this.props.enterUrl){const e=await this.props.onActionInvoked("readClipboard");e&&(this.props.setUrl(e),this.props.enterUrl())}}async DeleteHandler(e){this.props.selectedUrlInput&&this.props.setUrl("")}async SelectAllHandler(e){this.props.selectUrl&&this.props.selectUrl()}}class w extends o.Component{constructor(e){super(e),this.state={hasChanged:!1,isFocused:!1,url:this.props.url,urlSelectionStart:0,urlSelectionEnd:0,contextMenuProps:{menuItems:[],isVisible:!1,position:{x:0,y:0},setVisibility:this.setVisibility.bind(this),setUrl:this.setUrl.bind(this),enterUrl:this.enterUrl.bind(this),selectUrl:this.selectUrl.bind(this),onActionInvoked:this.props.onActionInvoked,selectedUrlInput:""}},this.handleChange=this.handleChange.bind(this),this.handleFocus=this.handleFocus.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleContextMenu=this.handleContextMenu.bind(this),this.setRef=this.setRef.bind(this)}UNSAFE_componentWillReceiveProps(e){e.url===this.state.url||this.state.hasChanged||this.setState({url:e.url})}setVisibility(e){this.setState({contextMenuProps:a(a({},this.state.contextMenuProps),{isVisible:e})})}setUrl(e){let t=null;if(this.state.urlSelectionStart&&this.state.urlSelectionEnd){const i=this.state.url,s=i.slice(0,this.state.urlSelectionStart),n=i.slice(this.state.urlSelectionEnd);t=(s+e).length,e=s+e+n}else if(this.state.urlSelectionStart){const i=this.state.url,s=i.slice(0,this.state.urlSelectionStart),n=i.slice(this.state.urlSelectionStart);t=(s+e).length,e=s+e+n}e!==this.state.url&&(this.setState({url:e,hasChanged:!0,isFocused:!0}),this.ref&&t&&(this.ref.focus(),this.ref.setSelectionRange(t,t)))}render(){return o.createElement(o.Fragment,null,o.createElement("input",{className:"urlbar",type:"text",ref:this.setRef,value:this.state.url,onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleChange,onKeyDown:this.handleKeyDown,onContextMenu:this.handleContextMenu}),o.createElement(g,a({},this.state.contextMenuProps)))}setRef(e){this.ref=e}handleChange(e){this.setState({url:e.target.value,hasChanged:!0})}handleFocus(e){this.selectUrl(e.target)}selectUrl(e){!e&&this.ref&&(e=this.ref),e&&(e.select(),this.setState({isFocused:!0}))}handleBlur(e){this.setState({isFocused:!1})}handleContextMenu(e){var t;e.preventDefault(),this.setState({urlSelectionStart:e.currentTarget.selectionStart,urlSelectionEnd:e.currentTarget.selectionEnd,contextMenuProps:a(a({},this.state.contextMenuProps),{isVisible:!0,position:{x:e.clientX,y:e.clientY},selectedUrlInput:this.state.isFocused&&(null==(t=null==window?void 0:window.getSelection())?void 0:t.toString())||""})})}enterUrl(){let e=this.state.url.trimLeft();e.match(/^(https?|about|chrome|file):/)||(e=`http://${this.state.url}`),this.setState({hasChanged:!1}),this.props.onUrlChanged(e)}handleKeyDown(e){13===e.keyCode&&this.enterUrl()}}class b extends o.Component{constructor(e){super(e),this.handleWidthChange=this.handleWidthChange.bind(this),this.handleHeightChange=this.handleHeightChange.bind(this),this.handleDeviceChange=this.handleDeviceChange.bind(this),this.emulatedDevices=[{name:"Responsive",userAgent:"",viewport:[]},{name:"Macbook 15",userAgent:"",viewport:{width:1440,height:900}},{name:"Macbook 13",userAgent:"",viewport:{width:1280,height:800}}].concat(r).filter((e=>!e.viewport.isLandscape))}render(){this.viewportMetadata=this.props.viewportMetadata;const e=this.viewportMetadata.emulatedDeviceId||"",t=[{label:`Fit (${Math.round(100*this.viewportMetadata.screenZoom)}%)`,value:"fit"}],i=0|this.viewportMetadata.height,s=0|this.viewportMetadata.width;return o.createElement("div",{className:"device-settings "+(this.props.isVisible?"active":"")},o.createElement("select",{className:"device-selector",onChange:this.handleDeviceChange,value:e},this.emulatedDevices.map((e=>o.createElement("option",{key:e.name,value:e.name,selected:e.selected},e.name)))),o.createElement("span",{className:"metadata"},o.createElement("input",{className:"viewport-size-input",type:"number",min:"0",value:s,onChange:this.handleWidthChange}),o.createElement("span",{className:"spacer"},"𝗑"),o.createElement("input",{className:"viewport-size-input",type:"number",min:"0",value:i,onChange:this.handleHeightChange})),o.createElement("select",{className:"device-selector",value:"fit"},t.map((e=>o.createElement("option",{key:e.value,value:e.value},e.label)))))}handleDeviceChange(e){const t=e.target.value,i=this.emulatedDevices.find((e=>e.name==t));this.props.onDeviceChange(i)}handleHeightChange(e){const t=parseInt(e.target.value);this.props.onViewportSizeChange({height:t,width:this.props.width})}handleWidthChange(e){const t=parseInt(e.target.value);this.props.onViewportSizeChange({width:t,height:this.props.height})}}function f(e){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 32 32"},e),o.createElement("path",{d:"M14 26l1.41-1.41L7.83 17H28v-2H7.83l7.58-7.59L14 6L4 16l10 10z",fill:"currentColor"}))}function y(e){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 32 32"},e),o.createElement("path",{d:"M18 6l-1.43 1.393L24.15 15H4v2h20.15l-7.58 7.573L18 26l10-10L18 6z",fill:"currentColor"}))}function C(e){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 32 32"},e),o.createElement("path",{d:"M12 10H6.78A11 11 0 0 1 27 16h2A13 13 0 0 0 6 7.68V4H4v8h8z",fill:"currentColor"}),o.createElement("path",{d:"M20 22h5.22A11 11 0 0 1 5 16H3a13 13 0 0 0 23 8.32V28h2v-8h-8z",fill:"currentColor"}))}function I(e){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 32 32"},e),o.createElement("path",{d:"M10 30H4a2 2 0 0 1-2-2V16a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2zM4 16v12h6V16z",fill:"currentColor"}),o.createElement("path",{d:"M28 4H6a2 2 0 0 0-2 2v6h2V6h22v14H14v2h2v4h-2v2h9v-2h-5v-4h10a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z",fill:"currentColor"}))}class E extends o.Component{constructor(e){super(e),this.handleBack=this.handleBack.bind(this),this.handleForward=this.handleForward.bind(this),this.handleRefresh=this.handleRefresh.bind(this),this.handleUrlChange=this.handleUrlChange.bind(this),this.handleInspect=this.handleInspect.bind(this),this.handleEmulateDevice=this.handleEmulateDevice.bind(this),this.handleDeviceChange=this.handleDeviceChange.bind(this),this.handleViewportSizeChange=this.handleViewportSizeChange.bind(this)}render(){return this.viewportMetadata=this.props.viewport,o.createElement("div",{className:"toolbar"},o.createElement("div",{className:"inner"},o.createElement("button",{className:"backward",onClick:this.handleBack,disabled:this.props.canGoBack},o.createElement(f,null)),o.createElement("button",{className:"forward",onClick:this.handleForward,disabled:this.props.canGoForward},o.createElement(y,null)),o.createElement("button",{className:"refresh",onClick:this.handleRefresh},o.createElement(C,null)),o.createElement(w,{url:this.props.url,onUrlChanged:this.handleUrlChange,onActionInvoked:this.props.onActionInvoked}),o.createElement("button",{className:"device "+(this.props.isDeviceEmulationEnabled?"active":""),title:"Emulate device",onClick:this.handleEmulateDevice},o.createElement(I,null))),o.createElement(b,{viewportMetadata:this.viewportMetadata,isVisible:this.props.isDeviceEmulationEnabled,onDeviceChange:this.handleDeviceChange,onViewportSizeChange:this.handleViewportSizeChange}))}handleUrlChange(e){this.props.onActionInvoked("urlChange",{url:e})}handleBack(){this.props.onActionInvoked("backward",{})}handleForward(){this.props.onActionInvoked("forward",{})}handleRefresh(){this.props.onActionInvoked("refresh",{})}handleInspect(){this.props.onActionInvoked("inspect",{})}handleEmulateDevice(){this.props.onActionInvoked("emulateDevice",{})}handleViewportSizeChange(e){this.props.onActionInvoked("viewportSizeChange",{height:e.height,width:e.width})}handleDeviceChange(e){this.props.onActionInvoked("viewportDeviceChange",{device:e})}}class M extends o.Component{constructor(e){super(e)}render(){return o.createElement("div",{className:"loading-bar"},o.createElement("div",{className:"bar",style:this.getBarStyle()}))}getBarStyle(){const{percent:e}=this.props;return{display:e>0?"block":"none",width:100*e+"%"}}}class S extends o.Component{constructor(e){super(e),this.canvasRef=o.createRef(),this.imageRef=o.createRef(),this.frameId=null,this.handleMouseEvent=this.handleMouseEvent.bind(this),this.handleKeyEvent=this.handleKeyEvent.bind(this),this.renderLoop=this.renderLoop.bind(this),this.state={imageZoom:1,screenOffsetTop:0}}static getDerivedStateFromProps(e,t){return e.frame!==t.frame?{frame:e.frame}:null}componentDidMount(){this.startLoop()}componentWillUnmount(){this.stopLoop()}startLoop(){this.frameId||(this.frameId=window.requestAnimationFrame(this.renderLoop))}stopLoop(){this.frameId&&window.cancelAnimationFrame(this.frameId)}renderLoop(){this.frameId=window.requestAnimationFrame(this.renderLoop)}render(){var e,t;const i={cursor:(null==(e=this.props.viewportMetadata)?void 0:e.cursor)||"auto"},s=null==(t=this.props.frame)?void 0:t.base64Data,n=this.props.format;return o.createElement("img",{className:"screencast",src:`data:image/${n};base64,${s}`,ref:this.imageRef,style:i,width:this.props.width,draggable:"false",onMouseDown:this.handleMouseEvent,onMouseUp:this.handleMouseEvent,onMouseMove:this.handleMouseEvent,onClick:this.handleMouseEvent,onWheel:this.handleMouseEvent,onKeyDown:this.handleKeyEvent,onKeyUp:this.handleKeyEvent,onKeyPress:this.handleKeyEvent,tabIndex:0})}handleMouseEvent(e){if(this.props.isInspectEnabled){if("click"===e.type){const t=this.convertIntoScreenSpace(e,this.state);this.props.onInspectElement({position:t})}else if("mousemove"===e.type){const t=this.convertIntoScreenSpace(e,this.state);this.props.onInspectHighlightRequested({position:t})}}else this.dispatchMouseEvent(e.nativeEvent);if("mousemove"===e.type){const t=this.convertIntoScreenSpace(e,this.state);this.props.onMouseMoved({position:t})}"mousedown"===e.type&&this.canvasRef.current&&this.canvasRef.current.focus()}convertIntoScreenSpace(e,t){let i=0;this.canvasRef&&this.canvasRef.current&&(i=this.canvasRef.current.getBoundingClientRect().top);const{screenZoom:s}=this.props.viewportMetadata,{scrollOffsetX:n,scrollOffsetY:a}=this.props.frame.metadata;return{x:Math.round(e.clientX/s+n),y:Math.round(e.clientY/s-i+a)}}handleKeyEvent(e){this.emitKeyEvent(e.nativeEvent),"Tab"===e.key&&e.preventDefault(),this.canvasRef.current&&this.canvasRef.current.focus()}modifiersForEvent(e){return(e.altKey?1:0)|(e.ctrlKey?2:0)|(e.metaKey?4:0)|(e.shiftKey?8:0)}emitKeyEvent(e){let t;switch(e.type){case"keydown":t="keyDown";break;case"keyup":t="keyUp";break;case"keypress":t="char";break;default:return}const i="keypress"===e.type?String.fromCharCode(e.charCode):void 0,s={type:t,modifiers:this.modifiersForEvent(e),text:i,unmodifiedText:i?i.toLowerCase():void 0,keyIdentifier:e.keyIdentifier,code:e.code,key:e.key,windowsVirtualKeyCode:e.keyCode,nativeVirtualKeyCode:e.keyCode,autoRepeat:!1,isKeypad:!1,isSystemKey:!1};this.props.onInteraction("Input.dispatchKeyEvent",s)}dispatchMouseEvent(e){let t=0;const i={mousedown:"mousePressed",mouseup:"mouseReleased",mousemove:"mouseMoved",wheel:"mouseWheel"};if(!(e.type in i))return;const{screenZoom:s}=this.props.viewportMetadata,n=Math.round(e.offsetX/s),a=Math.round(e.offsetY/s),o=i[e.type];"mousePressed"!=o&&"mouseReleased"!=o||(t=1);const r={type:o,x:n,y:a,modifiers:this.modifiersForEvent(e),button:{0:"none",1:"left",2:"middle",3:"right"}[e.which],clickCount:t,deltaX:0,deltaY:0};"mouseWheel"===o&&(r.deltaX=e.deltaX/s,r.deltaY=e.deltaY/s),this.props.onInteraction("Input.dispatchMouseEvent",r)}}function k(e){return o.createElement("svg",a({width:"1em",height:"1em",viewBox:"0 0 24 24"},e),o.createElement("circle",{cx:"12",cy:"12",r:"10",className:"uim-tertiary",opacity:".5",fill:"currentColor"}),o.createElement("circle",{cx:"12",cy:"16",r:"1",className:"uim-primary",fill:"currentColor"}),o.createElement("path",{className:"uim-primary",d:"M12 13a1 1 0 0 1-1-1V8a1 1 0 0 1 2 0v4a1 1 0 0 1-1 1z",fill:"currentColor"}))}function D(e={}){return o.createElement("div",{className:"error-page"},o.createElement(k,{className:"icon"}),o.createElement("div",{className:"title"},"Failed to load the page"),o.createElement("div",{className:"message"},e.errorText||null),o.createElement("button",{style:{width:"auto",fontSize:"0.9em",padding:"8px 12px"},onClick:function(){e.onActionInvoked("refresh",{})}},"Refresh"))}class N extends o.Component{constructor(e){super(e),this.viewportRef=o.createRef(),this.viewportPadding={top:70,left:30,right:30,bottom:30},this.debouncedResizeHandler=h(this.handleViewportResize.bind(this),50),this.handleInspectElement=this.handleInspectElement.bind(this),this.handleInspectHighlightRequested=this.handleInspectHighlightRequested.bind(this),this.handleScreencastInteraction=this.handleScreencastInteraction.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleMouseMoved=this.handleMouseMoved.bind(this),this.onActionInvoked=this.props.onActionInvoked.bind(this)}componentDidMount(){this.debouncedResizeHandler(),window.addEventListener("resize",this.debouncedResizeHandler)}componentWillUnmount(){window.removeEventListener("resize",this.debouncedResizeHandler)}render(){const e=this.props.viewport,t=Math.round(e.width*e.screenZoom),i=Math.round(e.height*e.screenZoom);let s={top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};return e.isResizable&&(s={top:!0,topRight:!0,topLeft:!0,bottom:!0,bottomRight:!0,bottomLeft:!0,left:!0,right:!0}),o.createElement("div",{className:"viewport "+(this.props.isDeviceEmulationEnabled?"viewport-resizable":""),ref:this.viewportRef},o.createElement(M,{percent:e.loadingPercent}),this.props.errorText?o.createElement(D,{errorText:this.props.errorText,onActionInvoked:this.onActionInvoked}):o.createElement(l,{className:"viewport-resizable-wrap",size:{width:t,height:i},onResizeStop:this.handleResizeStop,enable:s,handleClasses:{bottom:"viewport-resizer resizer-bottom",bottomRight:"viewport-resizer resizer-bottom-right",bottomLeft:"viewport-resizer resizer-bottom-left",left:"viewport-resizer resizer-left",right:"viewport-resizer resizer-right",top:"viewport-resizer resizer-top",topRight:"viewport-resizer resizer-top-right",topLeft:"viewport-resizer resizer-top-left"}},o.createElement(S,{height:i,width:t,frame:this.props.frame,format:this.props.format,viewportMetadata:e,isInspectEnabled:this.props.isInspectEnabled,onInspectElement:this.handleInspectElement,onInspectHighlightRequested:this.handleInspectHighlightRequested,onInteraction:this.handleScreencastInteraction,onMouseMoved:this.handleMouseMoved})))}calculateViewport(){this.calculateViewportSize(),this.calculateViewportZoom()}calculateViewportZoom(){let e=1;const t=this.props.viewport;if(!t.isFixedZoom){if(t.isFixedSize){const i={height:window.innerHeight-38,width:window.innerWidth};this.props.isDeviceEmulationEnabled&&(i.width=i.width-this.viewportPadding.left-this.viewportPadding.right,i.height=i.height-this.viewportPadding.bottom-this.viewportPadding.top),e=Math.min(i.width/t.width,i.height/t.height)}e!==t.screenZoom&&this.emitViewportChanges({screenZoom:e})}}calculateViewportSize(){const e=this.props.viewport;if(!e.isFixedSize&&this.viewportRef.current){const t=this.viewportRef.current.getBoundingClientRect();let i=t.width,s=t.height;if(this.props.isDeviceEmulationEnabled&&(i=i-this.viewportPadding.left-this.viewportPadding.right,s=s-this.viewportPadding.bottom-this.viewportPadding.top),s=Math.floor(s),i=Math.floor(i),i===Math.floor(e.width)&&s===Math.floor(e.height))return;this.emitViewportChanges({width:i,height:s})}}handleViewportResize(){this.calculateViewport()}handleResizeStop(e,t,i,s){const n=this.props.viewport;this.emitViewportChanges({width:n.width+s.width,height:n.height+s.height,isFixedSize:!0})}handleInspectElement(e){this.props.onViewportChanged("inspectElement",{params:e})}handleInspectHighlightRequested(e){this.props.onViewportChanged("inspectHighlightRequested",{params:e})}handleScreencastInteraction(e,t){this.props.onViewportChanged("interaction",{action:e,params:t})}handleMouseMoved(e){this.props.onViewportChanged("hoverElementChanged",{params:e})}emitViewportChanges(e){this.props.onViewportChanged("size",e)}}class R{constructor(){this.enabled=!1}enable(){this.enabled=!0}disable(){this.enabled=!1}log(...e){this.enabled&&console.log(...e)}}class V extends d.EventEmitter2{constructor(){super(),this.lastId=0,this.callbacks=new Map,this.logger=new R,window.addEventListener("message",(e=>this.onMessage(e)))}send(e,t={}){const i=++this.lastId;if(this.logger.log("SEND ► ",e,t),!this.vscode)try{this.vscode=acquireVsCodeApi()}catch(s){this.vscode=null}return this.vscode&&this.vscode.postMessage({callbackId:i,params:t,type:e}),new Promise(((t,s)=>{this.callbacks.set(i,{resolve:t,reject:s,error:new Error,method:e})}))}onMessage(e){const t=e.data;if(t)if(t.callbackId){const e=this.callbacks.get(t.callbackId);e&&(this.callbacks.delete(t.callbackId),t.error?e.reject(t.error,e.method,t):e.resolve(t.result))}else this.emit(t.method,t.result)}enableVerboseLogging(e){e?this.logger.enable():this.logger.disable()}}class x{constructor(e){this.connection=e}async resolveElementProperties(e,t){const i=await this.getProperties(e),s=async(e,i)=>{const n={},a=0|i;for(const o of e){let e=null;if(o.value)if("object"===o.value.type)if(o.value.objectId)if(a<t){if(e=await this.getProperties(o.value.objectId),Array.isArray(e)){const t=a+1;e=await s(e,t)}}else e="<max depth reached>";else o.value.value&&(e=o.value.value);else"function"===o.value.type?e="function":("string"===o.value.type||"number"===o.value.type)&&(e=o.value.value);Object.defineProperty(n,o.name,{value:e,enumerable:o.enumerable,configurable:o.configurable,writable:o.writable})}return n};return await s(i,0)}async getProperties(e){return(await this.connection.send("Runtime.getProperties",{objectId:e,ownProperties:!0})).result}async getCursorForNode(e){let t=e.nodeId;if(e.nodeId||(t=this.getNodeIdFromBackendId(e.backendNodeId)),!t)return;return(await this.connection.send("CSS.getComputedStyleForNode",{nodeId:t})).computedStyle.find((e=>"cursor"===e.name)).value}async getNodeIdFromBackendId(e){await this.connection.send("DOM.getDocument");const t=await this.connection.send("DOM.pushNodesByBackendIdsToFrontend",{backendNodeIds:[e]});if(t)return t.nodeIds[0]}}class z extends o.Component{constructor(e){super(e),this.viewport=void 0,this.state={frame:null,format:"png",url:"about:blank",quality:100,everyNthFrame:1,isVerboseMode:!1,isDebug:!1,errorText:void 0,isInspectEnabled:!1,isDeviceEmulationEnabled:!1,history:{canGoBack:!1,canGoForward:!1},viewportMetadata:{cursor:null,deviceSizeRatio:1,height:null,width:null,highlightNode:null,highlightInfo:null,emulatedDeviceId:"Responsive",isLoading:!1,isFixedSize:!1,isFixedZoom:!1,isResizable:!1,loadingPercent:0,screenZoom:1,scrollOffsetX:0,scrollOffsetY:0}},this.connection=new V,this.onToolbarActionInvoked=this.onToolbarActionInvoked.bind(this),this.onViewportChanged=this.onViewportChanged.bind(this),this.connection.enableVerboseLogging(this.state.isVerboseMode),this.connection.on("Page.navigatedWithinDocument",(e=>{this.requestNavigationHistory()})),this.connection.on("extension.appConfiguration",(e=>{this.updateState(e)})),this.connection.on("Page.frameNavigated",(e=>{const{frame:t}=e;!t.parentId&&(this.requestNavigationHistory(),this.updateState({viewportMetadata:a(a({},this.state.viewportMetadata),{isLoading:!0,loadingPercent:.1}),errorText:t.unreachableUrl?`Failed to reach ${t.unreachableUrl}`:void 0}))})),this.connection.on("Page.loadEventFired",(e=>{this.updateState({viewportMetadata:a(a({},this.state.viewportMetadata),{loadingPercent:1})}),setTimeout((()=>{this.updateState({viewportMetadata:a(a({},this.state.viewportMetadata),{isLoading:!1,loadingPercent:0})})}),500)})),this.connection.on("Page.screencastFrame",(e=>{this.handleScreencastFrame(e)})),this.connection.on("Page.windowOpen",(e=>{this.connection.send("extension.windowOpenRequested",{url:e.url})})),this.connection.on("Page.javascriptDialogOpening",(e=>{const{url:t,message:i,type:s}=e;this.connection.send("extension.windowDialogRequested",{url:t,message:i,type:s})})),this.connection.on("Page.frameResized",(e=>{this.stopCasting(),this.startCasting()})),this.connection.on("extension.appConfiguration",(e=>{e&&(this.stopCasting(),this.startCasting(),e.startUrl&&this.handleNavigate(e.startUrl))})),this.connection.on("extension.navigateTo",(({url:e})=>{this.handleNavigate(e)})),this.connection.on("extension.viewport",(e=>{this.handleViewportSizeChange(e)})),this.connection.send("Page.enable"),this.connection.send("DOM.enable"),this.connection.send("CSS.enable"),this.connection.send("Overlay.enable"),this.requestNavigationHistory(),this.startCasting(),this.cdpHelper=new x(this.connection)}async handleScreencastFrame(e){const{sessionId:t,data:i,metadata:s}=e;this.connection.send("Page.screencastFrameAck",{sessionId:t}),this.requestNodeHighlighting(),await this.updateState({frame:{base64Data:i,metadata:s},viewportMetadata:a(a(a({},this.state.viewportMetadata),this.nextViewportSize),{scrollOffsetX:s.scrollOffsetX,scrollOffsetY:s.scrollOffsetY})}),this.nextViewportSize=void 0}componentDidUpdate(){const{isVerboseMode:e}=this.state;this.connection.enableVerboseLogging(e)}render(){return o.createElement("div",{className:"App"},this.state.isDebug?null:o.createElement(E,{url:this.state.url,viewport:this.state.viewportMetadata,onActionInvoked:this.onToolbarActionInvoked,canGoBack:this.state.history.canGoBack,canGoForward:this.state.history.canGoForward,isInspectEnabled:this.state.isInspectEnabled,isDeviceEmulationEnabled:this.state.isDeviceEmulationEnabled}),o.createElement(N,{viewport:this.state.viewportMetadata,isInspectEnabled:this.state.isInspectEnabled,isDeviceEmulationEnabled:this.state.isDeviceEmulationEnabled,frame:this.state.frame,format:this.state.format,url:this.state.url,onActionInvoked:this.onToolbarActionInvoked,errorText:this.state.errorText,onViewportChanged:this.onViewportChanged,ref:e=>this.viewport=e}))}stopCasting(){this.connection.send("Page.stopScreencast")}startCasting(){const e={quality:this.state.quality,format:this.state.format,everyNthFrame:this.state.everyNthFrame};this.connection.send("Page.startScreencast",e)}async requestNavigationHistory(){const e=await this.connection.send("Page.getNavigationHistory");if(!e)return;const t=e.currentIndex,i=e.entries,s=i[t],n=s.url;this.updateState({url:n,history:{canGoBack:0===t,canGoForward:t===i.length-1}});const a=s.title||s.url;this.connection.send("extension.updateTitle",{title:a})}async onViewportChanged(e,t){switch(e){case"inspectHighlightRequested":this.handleInspectHighlightRequested(t);break;case"inspectElement":await this.handleInspectElementRequest(t),this.handleToggleInspect();break;case"hoverElementChanged":await this.handleElementChanged(t);break;case"interaction":this.connection.send(t.action,t.params);break;case"deviceChange":await this.updateState({viewportMetadata:a(a({},this.state.viewportMetadata),t)}),this.viewport.calculateViewport();break;case"size":void 0!==t.height&&void 0!==t.width&&(this.connection.send("Page.setDeviceMetricsOverride",{deviceScaleFactor:window.devicePixelRatio||1,mobile:!1,height:Math.floor(t.height),width:Math.floor(t.width)}),this.nextViewportSize={height:t.height,width:t.width})}}async updateState(e){return new Promise((t=>{this.setState(e,t)}))}async handleInspectHighlightRequested(e){const t=await this.connection.send("DOM.getNodeForLocation",{x:e.params.position.x,y:e.params.position.y});if(t){let e=t.nodeId;!t.nodeId&&t.backendNodeId&&(e=await this.cdpHelper.getNodeIdFromBackendId(t.backendNodeId)),this.setState({viewportMetadata:a(a({},this.state.viewportMetadata),{highlightNode:{nodeId:e,sourceMetadata:null}})}),this.requestNodeHighlighting()}}async resolveHighlightNodeSourceMetadata(){if(!this.state.viewportMetadata.highlightNode)return;const e=this.state.viewportMetadata.highlightNode.nodeId,t=await this.connection.send("DOM.resolveNode",{nodeId:e});if(t.object){const e=t.object.objectId,i=await this.cdpHelper.resolveElementProperties(e,3);if(i){const e=c(i);if(!e.fileName)return;this.setState({viewportMetadata:a(a({},this.state.viewportMetadata),{highlightNode:a(a({},this.state.viewportMetadata.highlightNode),{sourceMetadata:{fileName:e.fileName,columnNumber:e.columnNumber,lineNumber:e.lineNumber,charNumber:e.charNumber}})})})}}}async handleInspectElementRequest(e){if(!this.state.viewportMetadata.highlightNode)return;await this.resolveHighlightNodeSourceMetadata();const t=this.state.viewportMetadata.highlightNode.nodeId;this.connection.send("Overlay.inspectNodeRequested",{nodeId:t});const i=this.state.viewportMetadata.highlightNode.sourceMetadata;i&&this.connection.send("extension.openFile",{fileName:i.fileName,lineNumber:i.lineNumber,columnNumber:i.columnNumber,charNumber:i.charNumber})}onToolbarActionInvoked(e,t){switch(e){case"forward":this.connection.send("Page.goForward");break;case"backward":this.connection.send("Page.goBackward");break;case"refresh":this.connection.send("Page.reload");break;case"inspect":this.handleToggleInspect();break;case"emulateDevice":this.handleToggleDeviceEmulation();break;case"urlChange":this.handleNavigate(t.url);break;case"readClipboard":return this.connection.send("Clipboard.readText");case"writeClipboard":this.handleClipboardWrite(t);break;case"viewportSizeChange":this.handleViewportSizeChange(t);break;case"viewportDeviceChange":this.handleViewportDeviceChange(t)}return Promise.resolve()}handleToggleInspect(){this.state.isInspectEnabled?(this.connection.send("Overlay.hideHighlight"),this.updateState({isInspectEnabled:!1,viewportMetadata:a(a({},this.state.viewportMetadata),{highlightInfo:null,highlightNode:null})})):this.updateState({isInspectEnabled:!0})}async handleNavigate(e){const t=await this.connection.send("Page.navigate",{url:e});this.setState({url:e,errorText:t.errorText})}handleViewportSizeChange(e){this.onViewportChanged("size",{width:e.width,height:e.height})}handleViewportDeviceChange(e){const t="Responsive"===e.device.name,i="Responsive"!==e.device.name,s="Responsive"===e.device.name;this.onViewportChanged("deviceChange",{emulatedDeviceId:e.device.name,isResizable:t,isFixedSize:i,isFixedZoom:s,screenZoom:1}),e.device.viewport&&this.onViewportChanged("size",{width:e.device.viewport.width,height:e.device.viewport.height})}handleToggleDeviceEmulation(){this.state.isDeviceEmulationEnabled?this.disableViewportDeviceEmulation():this.enableViewportDeviceEmulation()}disableViewportDeviceEmulation(){this.handleViewportDeviceChange({device:{name:"Responsive",viewport:{width:this.state.viewportMetadata.width,height:this.state.viewportMetadata.height}}}),this.updateState({isDeviceEmulationEnabled:!1})}enableViewportDeviceEmulation(e="Responsive"){this.handleViewportDeviceChange({device:{name:e,viewport:{width:this.state.viewportMetadata.width,height:this.state.viewportMetadata.height}}}),this.updateState({isDeviceEmulationEnabled:!0})}handleClipboardWrite(e){if(e&&e.value)return this.connection.send("Clipboard.writeText",e)}async handleElementChanged(e){const t=await this.connection.send("DOM.getNodeForLocation",{x:e.params.position.x,y:e.params.position.y}),i=await this.cdpHelper.getCursorForNode(t);this.setState({viewportMetadata:a(a({},this.state.viewportMetadata),{cursor:i})})}async requestNodeHighlighting(){if(this.state.viewportMetadata.highlightNode){const e=this.state.viewportMetadata.highlightNode.nodeId,t=await this.connection.send("DOM.getBoxModel",{nodeId:e});await this.connection.send("Overlay.highlightNode",{nodeId:e,highlightConfig:{showInfo:!0,showStyles:!0,showRulers:!0,showExtensionLines:!0}}),t&&t.model&&this.setState({viewportMetadata:a(a({},this.state.viewportMetadata),{highlightInfo:t.model})})}}}p.render(o.createElement(z,null),document.getElementById("root"));
